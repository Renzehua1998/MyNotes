# 第六章 链路层和局域网

——广域网也有链路层，但是相对来说比较简单，所以重点放在局域网

——由一个节点如何到达另外一个相邻节点：点到点传输

目标：

- 原理：检错和纠错、共享广播信道（多点接入）、链路层寻址、LAN、可靠数据传输（Rdt、流量控制-讲过了）
- 实现：PPP、802.3、802.11

网络节点的连接方式：

- 点到点连接：广域网（物理限制、带宽延迟大-碰撞损失极大）——不用考虑寻址、访问控制
- 多点连接（共享介质、交换机AP）：局域网——多点访问控制（MAC）、寻址

## 6.1 引论和服务

**术语规范**：

1. 节点nodes：主机和路由器
2. 链路links：连接个相邻节点通信信道（有线无线）
3. 帧frame：链路层的PDU

——数据链路层负责从一个节点通过链路将（帧中的）数据报发送到相邻的物理节点

**上下文**：（类比与一个人乘坐不同的交通工具）

- 数据报（分组）在不同的链路上以不同的链路协议传送
- 不同的链路协议提供不同的服务

**链路层服务**：

- 成帧、链路接入：打包、获得信道使用权——使用“MAC”（物理）地址来标示源和目的
- 相邻两点间完成可靠数据传输：有些有，有些没有（本身可靠就不用、本身不可靠就必须进行差错控制）
- 流量控制、错误检测、差错纠正、半双工和全双工

**在哪里实现**？

——每台主机上的**网卡**（网络适配器、网络接口卡、NIC）：链路层+物理层。硬件、软件和固件的综合体

**适配器通信**：同时可以发可以接

- 发送方：封装、差错控制、发出去
- 接收方：监听、接收、检错、解封装

## 6.2 差错检测和纠正

EDC——差错控制编码，存在残存错误；D——被保护的数据内容

**校验方法**

- **奇偶校验**：一维、二维（可以定位出错位置）：对偶情况也可能检测不到。

- **校验和**：1的补码和，循环相加

- **CRC**（循环冗余校验）：

**CRC**：

1. **模2运算**——加法不进位、减法不借位（其实就是**按位异或**）
2. 位串的两种表示—— $x^3+x^1+1=1011$
3. **生成多项式**G——r次方的一个多项式表示一个比特序列：r+1位
4. 生成r位冗余位，使得**数据位+冗余位刚好能被生成多项式整除**。

$D·2^r\ XOR\ R = nG$ 两边再异或R，等价于：$D.2^r = nG\ XOR\ R $ 。——两边同除G，得到的余数就是 R

**计算R**：D左移R位除以生成多项式得到余数（不足R位补0）即为EDC，接收方判断能否整除即可。

**CRC性能分析**：（理论分析不要求掌握）

- 能够检查出所有的1bit错误
- 能够检查出所有的双bits的错误
- 能够检查出所有长度 =r或者<r 位的错误
- 长度为 r+1的突发错误，检查不出的概率是：$1/2^{r-1}$
- 长度大于r+1的突发错误，检查不出的概率：$1/2^{r}$

## 6.3 多点访问协议

### 概述

两种类型链路：点对点、多点连接

多路访问协议存在的问题：2个或更多站点同时传送: **冲突（collision）**

介质访问控制协议：MAC-算法角度（MAP-协议角度）

- 分布式算法-决定节点什么时候可以发送
- 共享控制的通信必须用借助信道本身传输

**理想**MAC协议**特性**：

1. 一个节点占用所有带宽
2. M个节点占用R/M带宽
3. 完全分布式，没有统一协调节点
4. 简单易行

**分类**：

1. 信道划分：分路复用
2. 随机访问：允许冲突，可以解决冲突
3. 依次轮流：有中心节点控制、令牌

### 信道划分MAC协议

略（通信知识）

1. TDMA：时分多路
2. FDMA：频分多路
3. CDMA：码分多路——第三代移动通信技术（过时了）

### 随机存取协议

- 有数据要发送时，全部带宽发送
- 多节点同时传输，冲突检测恢复
- 随机MAC协议：
  1. 时隙ALOHA
  2. ALOHA
  3. CSMA：**CSMA/CD**, **CSMA/CA** 重点！——载波侦听、多路访问

1. **时隙ALOHA**

   每个时隙可发送一帧，每个节点都可以检测到是否产生了冲突，每一个随后的时隙以概率p重传帧直到成功。延迟没有上限，无法保证最长时间。

   **优点**：简单、全速率传播、完全分布式

   **缺点**：存在空闲时隙、冲突浪费时隙、检测冲突时间小于完全发完时间、需要同步

   **效率分析**：一个节点成功传输概率是$p(1-p)^{N-1}$，任何一个节点的成功概率是$Np(1-p)^{N-1}$。求导求极值，f(p*)=37.5%——信道利用率37%

2. **纯ALOHA**

   有帧马上传输，碰撞就不发，其他和时隙ALOHA一样

   **效率分析**：任何一个节点的成功概率是$Np(1-p)^{2(N-1)}$，f(p*)=17.5%——信道利用率17%，更差了。

3. **CSMA**(载波侦听多路访问)——发之前听一听有没有人在发

   ——冲突仍然有可能发生，两个节点可能侦听不到正在进行的传输（信道延迟造成的**延迟**）。延迟越大，冲突发生的概率越大。

#### CSMA/CD(冲突检测)

——事前侦听，边说边听

- 冲突发生时则传输终止，减少对信道的浪费
- 有线局域网中容易实现，通过检测信号强度判断是否冲突

**以太网CSMA/CD算法**：
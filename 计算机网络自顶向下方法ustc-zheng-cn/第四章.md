# 第四章 网络层：数据平面

前几章在网络边缘，进入网络核心部分。

1. 导论（数据平面、控制平面）
2. 路由器结构组成
3. IP协议（格式、分片重组、地址转换、IPv4、IPv6）
4. SDN情况下数据平面（流表匹配）

## 4.1 导论

——**数据平面**、控制平面

- 服务模型
- **转发和路由**——分别是数据平面和控制平面，分为传统方式和SDN方式（四种）
- 路由器工作原理
- 通用转发

——协议实例与实现

### 功能概述

**网络层服务**：

- 主机对之间传送段（封装的传输层TCP段UDP数据报）
- 封装、解封装
- 协议存在于每个主机和路由器，路由器检查所有IP数据报头部

**关键功能**：

1. 转发：输入接口转发到输出接口（局部功能）
2. 路由：选择路径到达目标主机（全局功能）——算法、协议

**数据平面、控制平面**：

- 数据平面：转发（依靠路由表）——本地。传统：地址+转发表；SDN：多个字段+流表。
- 控制平面：路由（生成路由表）——全局。传统：路由器中实现；SDN：远程的服务器实现。

传统方式仅依靠IP地址，SDN方式匹配流表依靠**一系列字段**（MAC、配置信息等），SDN除了**转发**还可以**阻止（block）、泛洪、修改**等。SDN厂家的网络控制服务器通过南翔接口算出来流表分配给每个主机。

**传统方式和SDN方式**：

- 传统方式：**路由器** **分布式**计算路由表（Per-router），**两个平面紧耦合**。——很难改运行逻辑。
- SDN方式：**分组交换机**通过南向接口收到网络服务器的**集中控制**，**两个平面分开**。——很好改、可编程。

SDN：软件定义网络（software defined network）

### 服务模型

**指标**：

- 单个数据报：可靠性、延迟。
- 数据报流：保序性、带宽、延迟差（jitter）。

下下页具体模型（这些指标为特定值时表示某种模型）

1. **best effort**（尽力而为）：全部无法保证——IP
2. CBR（恒定速率）——下面都是ATM
3. VBR（变化速率）
4. ABR（可用比特率）
5. UBR（不指名比特率）

### 连接建立

某些架构中有连接（和传输层面向连接区别——连接还体现在交换路径上），如ATM等。

IP无连接建立的功能。

网络层和传输层连接服务区别：

- 网络层: 在2个主机之间，涉及到路径上的一些路由器
- 传输层: 在2个进程之间，很可能只体现在端系统上

## 4.2 路由器组成